networks:
  von:
    external: true

services:
  # Holder Agent
  holder:
    image: ghcr.io/openwallet-foundation/acapy-agent:py3.12-1.3.0
    container_name: ssi-holder
    ports:
      - "8030:8030"  # Inbound transport
      - "8031:8031"  # Admin API
    environment:
      - LEDGER_URL=http://webserver:8000
    networks:
      - von
    command: >
      start
        --endpoint http://holder:8030
        --label HolderWallet
        --inbound-transport http 0.0.0.0 8030
        --outbound-transport http
        --admin 0.0.0.0 8031
        --admin-insecure-mode
        --wallet-type askar
        --wallet-name holder.agent420695
        --wallet-key holder.agent420695
        --wallet-allow-insecure-seed
        --preserve-exchange-records
        --auto-provision
        --genesis-url http://webserver:8000/genesis
        --webhook-url http://192.168.15.20:8000/webhook
        --log-level INFO
        --debug-connections
        --auto-accept-invites
        --auto-accept-requests

  # create Public DID for Issuer - Usado para que os usuÃ¡rios da entidade Issuer possam fazer cadastro de schemas na ledger

  ledger-bootstrap-issuer:
    image: appropriate/curl
    entrypoint: >
      sh -c "
        curl -X POST http://webserver:8000/register -H 'Content-Type: application/json' -d '{\"seed\":\"000000000000000000000000Issuer01\",\"role\":\"TRUST_ANCHOR\"}';
      "
    networks:
    - von
    restart: "no"

  # Issuer Agent
  issuer:
    image: ghcr.io/openwallet-foundation/acapy-agent:py3.12-1.3.0
    depends_on:
      - ledger-bootstrap-issuer
    container_name: ssi-issuer
    ports:
      - "8040:8040"  # Inbound transport
      - "8041:8041"  # Admin API
    environment:
      - LEDGER_URL=http://webserver:8000
    networks:
      - von
    command: >
      start
        --endpoint http://issuer:8040
        --label IssuerWallet
        --inbound-transport http 0.0.0.0 8040
        --outbound-transport http
        --admin 0.0.0.0 8041
        --admin-insecure-mode
        --seed 000000000000000000000000Issuer01
        --public-invites
        --wallet-type askar
        --wallet-name issuer.agent420695
        --wallet-key issuer.agent420695
        --wallet-allow-insecure-seed
        --preserve-exchange-records
        --auto-provision
        --genesis-url http://webserver:8000/genesis
        --log-level INFO
        --debug-connections
        --auto-accept-invites
        --auto-accept-requests

  ledger-bootstrap-issuer-verifier:
    image: appropriate/curl
    entrypoint: >
      sh -c "
        curl -X POST http://webserver:8000/register -H 'Content-Type: application/json' -d '{\"seed\":\"0000000000000000000000Verifier01\",\"role\":\"TRUST_ANCHOR\"}';
      "
    networks:
    - von
    restart: "no"

  # Issuer+Verifier Agent
  issuer-verifier:
    image: ghcr.io/openwallet-foundation/acapy-agent:py3.12-1.3.0
    container_name: ssi-issuer-verifier
    ports:
      - "8050:8050"  # Inbound transport
      - "8051:8051"  # Admin API
    environment:
      - LEDGER_URL=http://webserver:8000
    networks:
      - von
    command: >
        start
        --endpoint http://issuer-verifier:8050
        --label IssuerVerifierWallet
        --inbound-transport http 0.0.0.0 8050
        --outbound-transport http
        --admin 0.0.0.0 8051
        --admin-insecure-mode
        --seed 0000000000000000000000Verifier01
        --public-invites
        --wallet-type askar
        --wallet-name issuer-verifier.agent420695
        --wallet-key issuer-verifier.agent420695
        --wallet-allow-insecure-seed
        --preserve-exchange-records
        --auto-provision
        --genesis-url http://webserver:8000/genesis
        --log-level INFO
        --debug-connections
        --auto-accept-invites
        --auto-accept-requests